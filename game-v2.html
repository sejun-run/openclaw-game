<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#1a1a2e">
  <title>ì„œë²„ ë””íœìŠ¤ v2</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: manipulation;
    }
    
    body {
      background: linear-gradient(180deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%);
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      user-select: none;
      -webkit-user-select: none;
    }

    /* ê²Œì„ ì»¨í…Œì´ë„ˆ - ì „ì²´ í™”ë©´ */
    .game {
      width: 100%;
      height: 100%;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      padding: 5px;
      padding-top: env(safe-area-inset-top, 5px);
      padding-bottom: env(safe-area-inset-bottom, 5px);
    }

    /* ìƒëŒ€ ì˜ì—­ (ìƒë‹¨) */
    .enemy-area {
      flex: 0 0 auto;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    /* ìƒíƒœë°” */
    .status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 5px 10px;
      background: rgba(0,0,0,0.4);
      border-radius: 8px;
    }

    .player-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .player-icon {
      font-size: 1.2em;
    }

    .player-name {
      font-weight: bold;
      font-size: 0.85em;
    }

    .enemy-area .player-name { color: #ff6b6b; }
    .player-area .player-name { color: #4ecdc4; }

    .hp-bar {
      width: 120px;
      height: 16px;
      background: #333;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    .hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #27ae60, #2ecc71);
      transition: width 0.3s;
    }

    .hp-fill.low { background: linear-gradient(90deg, #c0392b, #e74c3c); }

    .hp-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7em;
      font-weight: bold;
      text-shadow: 1px 1px 2px #000;
    }

    .mana-display {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(0, 150, 255, 0.3);
      padding: 4px 10px;
      border-radius: 12px;
    }

    .mana-icon { font-size: 1em; }
    .mana-text { font-weight: bold; font-size: 0.9em; }

    /* í•„ë“œ ì˜ì—­ */
    .field {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 60px;
      padding: 5px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      margin: 3px 0;
    }

    .field-placeholder {
      color: #555;
      font-size: 0.75em;
    }

    /* ì¤‘ì•™ ë¶„ë¦¬ì„  */
    .battle-divider {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3px 0;
    }

    .divider-line {
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, transparent, #444, transparent);
    }

    .vs-badge {
      padding: 3px 15px;
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      border-radius: 12px;
      font-size: 0.75em;
      font-weight: bold;
      margin: 0 10px;
    }

    /* í”Œë ˆì´ì–´ ì˜ì—­ (í•˜ë‹¨) */
    .player-area {
      flex: 0 0 auto;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    /* í•¸ë“œ ì˜ì—­ */
    .hand-area {
      position: relative;
      height: 90px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 5px;
    }

    .hand {
      display: flex;
      justify-content: center;
      position: relative;
    }

    /* í•¸ë“œ ì¹´ë“œ - ë¶€ì±„ê¼´ ë°°ì¹˜ */
    .hand-card {
      width: 65px;
      height: 85px;
      background: linear-gradient(145deg, #2a2a5a, #1a1a3e);
      border: 2px solid #444;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      margin: 0 -15px;
      transform-origin: bottom center;
    }

    .hand-card:hover {
      transform: translateY(-20px) scale(1.1);
      z-index: 100;
      border-color: #00d9ff;
      box-shadow: 0 10px 30px rgba(0, 217, 255, 0.4);
    }

    .hand-card.selected {
      transform: translateY(-30px) scale(1.15);
      z-index: 101;
      border-color: #00ff88;
      box-shadow: 0 15px 40px rgba(0, 255, 136, 0.5);
    }

    .hand-card.disabled {
      opacity: 0.5;
      filter: grayscale(0.5);
    }

    .hand-card .cost {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 22px;
      height: 22px;
      background: linear-gradient(135deg, #3498db, #2980b9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75em;
      font-weight: bold;
      border: 2px solid #fff;
    }

    .hand-card .icon {
      font-size: 1.8em;
      line-height: 1;
    }

    .hand-card .name {
      font-size: 0.55em;
      text-align: center;
      margin-top: 2px;
      max-width: 90%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .hand-card .stats {
      display: flex;
      gap: 8px;
      font-size: 0.55em;
      margin-top: 3px;
    }

    .hand-card .atk { color: #e74c3c; }
    .hand-card .hp { color: #2ecc71; }

    /* í•„ë“œ ì¹´ë“œ */
    .field-card {
      width: 55px;
      height: 70px;
      background: linear-gradient(145deg, #2a2a5a, #1a1a3e);
      border: 2px solid #555;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }

    .field-card:hover {
      border-color: #00d9ff;
      transform: scale(1.05);
    }

    .field-card.can-attack {
      border-color: #00ff88;
      box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 5px rgba(0, 255, 136, 0.5); }
      50% { box-shadow: 0 0 15px rgba(0, 255, 136, 0.8); }
    }

    .field-card .icon { font-size: 1.4em; }
    .field-card .name { font-size: 0.5em; margin-top: 2px; }

    .field-card .card-hp {
      position: absolute;
      bottom: 2px;
      right: 2px;
      background: #27ae60;
      color: #fff;
      padding: 1px 4px;
      border-radius: 4px;
      font-size: 0.5em;
      font-weight: bold;
    }

    .field-card .card-atk {
      position: absolute;
      bottom: 2px;
      left: 2px;
      background: #e74c3c;
      color: #fff;
      padding: 1px 4px;
      border-radius: 4px;
      font-size: 0.5em;
      font-weight: bold;
    }

    /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */
    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 5px 0;
    }

    .btn {
      padding: 8px 20px;
      border: none;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #00d9ff, #00ff88);
      color: #000;
    }

    .btn-danger {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: #fff;
    }

    .btn:active { transform: scale(0.95); }

    /* ì¹´ë“œ ìƒì„¸ ì˜¤ë²„ë ˆì´ */
    .card-detail-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .card-detail-overlay.active {
      display: flex;
    }

    .card-detail {
      background: linear-gradient(145deg, #2a2a5a, #1a1a3e);
      border-radius: 15px;
      padding: 20px;
      max-width: 350px;
      width: 100%;
      text-align: center;
      border: 2px solid #444;
    }

    .card-detail .icon { font-size: 3em; margin-bottom: 10px; }
    .card-detail .name { font-size: 1.4em; font-weight: bold; margin-bottom: 5px; }
    .card-detail .category { font-size: 0.8em; color: #888; margin-bottom: 15px; }

    .card-detail .stats-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 15px;
    }

    .card-detail .stat-box {
      background: rgba(0,0,0,0.3);
      padding: 8px 15px;
      border-radius: 8px;
    }

    .card-detail .stat-value { font-size: 1.2em; font-weight: bold; }
    .card-detail .stat-label { font-size: 0.7em; color: #888; }

    .card-detail .description {
      font-size: 0.85em;
      color: #ccc;
      line-height: 1.5;
      margin-bottom: 15px;
      text-align: left;
    }

    .card-detail .effect {
      background: rgba(0, 217, 255, 0.1);
      border-left: 3px solid #00d9ff;
      padding: 10px;
      font-size: 0.8em;
      text-align: left;
      margin-bottom: 15px;
      border-radius: 0 8px 8px 0;
    }

    .card-detail .services {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .card-detail .service-tag {
      background: rgba(255,255,255,0.1);
      padding: 3px 10px;
      border-radius: 10px;
      font-size: 0.75em;
    }

    .card-detail .actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .card-detail .btn { min-width: 100px; }

    /* ë°°í‹€ ë¡œê·¸ (ì‘ê²Œ) */
    .battle-log {
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.6);
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 0.65em;
      max-width: 150px;
      max-height: 80px;
      overflow-y: auto;
    }

    .log-entry { padding: 2px 0; color: #aaa; }
    .log-entry.damage { color: #e74c3c; }
    .log-entry.info { color: #00d9ff; }

    /* ê²Œì„ ì‹œì‘ í™”ë©´ */
    .start-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, #0f0f23, #1a1a3e);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 500;
      padding: 20px;
      text-align: center;
    }

    .start-screen.hidden { display: none; }

    .start-screen h1 {
      font-size: 2em;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #00d9ff, #00ff88);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .start-screen p { color: #888; margin-bottom: 30px; }

    .difficulty-btns {
      display: flex;
      gap: 15px;
    }

    .diff-btn {
      padding: 15px 25px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s;
    }

    .diff-btn:hover {
      border-color: #00d9ff;
      background: rgba(0, 217, 255, 0.1);
    }

    .diff-btn h3 { margin-bottom: 5px; }
    .diff-btn p { font-size: 0.8em; color: #888; margin: 0; }

    /* ê²Œì„ ì˜¤ë²„ */
    .game-over {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .game-over.active { display: flex; }

    .game-over h2 { font-size: 2.5em; margin-bottom: 20px; }
    .game-over.win h2 { color: #00ff88; }
    .game-over.lose h2 { color: #e74c3c; }
    .game-over p { color: #888; margin-bottom: 30px; }
  </style>
</head>
<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div class="start-screen" id="startScreen">
    <h1>ğŸƒ ì„œë²„ ë””íœìŠ¤</h1>
    <p>ì¸í”„ë¼ ì¹´ë“œê²Œì„ìœ¼ë¡œ ë°°ìš°ëŠ” í´ë¼ìš°ë“œ</p>
    <div class="difficulty-btns">
      <div class="diff-btn" onclick="startGame('easy')">
        <h3>ğŸŸ¢ ì‰¬ì›€</h3>
        <p>ì…ë¬¸ììš©</p>
      </div>
      <div class="diff-btn" onclick="startGame('normal')">
        <h3>ğŸŸ¡ ë³´í†µ</h3>
        <p>ê¸°ë³¸</p>
      </div>
      <div class="diff-btn" onclick="startGame('hard')">
        <h3>ğŸ”´ ì–´ë ¤ì›€</h3>
        <p>ë„ì „!</p>
      </div>
    </div>
  </div>

  <!-- ê²Œì„ í™”ë©´ -->
  <div class="game" id="gameScreen">
    <!-- ìƒëŒ€ ì˜ì—­ -->
    <div class="enemy-area">
      <div class="status-bar">
        <div class="player-info">
          <span class="player-icon">ğŸ¤–</span>
          <span class="player-name">DDoS ë´‡</span>
          <div class="hp-bar">
            <div class="hp-fill" id="enemyHpFill" style="width: 100%"></div>
            <span class="hp-text" id="enemyHpText">100/100</span>
          </div>
        </div>
        <div class="mana-display">
          <span class="mana-icon">âš¡</span>
          <span class="mana-text" id="manaText">1/1</span>
        </div>
      </div>
      <div class="field" id="enemyField">
        <span class="field-placeholder">ì  ì„œë²„</span>
      </div>
    </div>

    <!-- ì¤‘ì•™ ë¶„ë¦¬ì„  + ë¡œê·¸ -->
    <div class="battle-divider">
      <div class="divider-line"></div>
      <span class="vs-badge">VS</span>
      <div class="divider-line"></div>
    </div>
    <div class="battle-log" id="battleLog">
      <div class="log-entry info">ê²Œì„ ì‹œì‘!</div>
    </div>

    <!-- í”Œë ˆì´ì–´ ì˜ì—­ -->
    <div class="player-area">
      <div class="field" id="playerField">
        <span class="field-placeholder">ì¹´ë“œë¥¼ ë°°ì¹˜í•˜ì„¸ìš”</span>
      </div>
      <div class="status-bar">
        <div class="player-info">
          <span class="player-icon">ğŸ‘¤</span>
          <span class="player-name">ë‚˜</span>
          <div class="hp-bar">
            <div class="hp-fill" id="playerHpFill" style="width: 100%"></div>
            <span class="hp-text" id="playerHpText">100/100</span>
          </div>
        </div>
        <button class="btn btn-primary" id="endTurnBtn" onclick="endTurn()">í„´ ì¢…ë£Œ</button>
      </div>
      <div class="hand-area">
        <div class="hand" id="playerHand"></div>
      </div>
    </div>
  </div>

  <!-- ì¹´ë“œ ìƒì„¸ ì˜¤ë²„ë ˆì´ -->
  <div class="card-detail-overlay" id="cardDetailOverlay" onclick="closeCardDetail(event)">
    <div class="card-detail" id="cardDetail" onclick="event.stopPropagation()">
      <div class="icon" id="detailIcon">ğŸ–¥ï¸</div>
      <div class="name" id="detailName">EC2</div>
      <div class="category" id="detailCategory">ì»´í“¨íŒ…</div>
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-value" id="detailCost">3</div>
          <div class="stat-label">ì½”ìŠ¤íŠ¸</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="detailHp">100</div>
          <div class="stat-label">HP</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="detailAtk">20</div>
          <div class="stat-label">ê³µê²©ë ¥</div>
        </div>
      </div>
      <div class="description" id="detailDesc">ì„¤ëª…</div>
      <div class="effect" id="detailEffect">ğŸ’¡ ê²Œì„ íš¨ê³¼</div>
      <div class="services" id="detailServices"></div>
      <div class="actions" id="detailActions">
        <button class="btn btn-primary" onclick="playSelectedCard()">ë°°ì¹˜</button>
        <button class="btn btn-danger" onclick="closeCardDetail()">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ê²Œì„ ì˜¤ë²„ -->
  <div class="game-over" id="gameOver">
    <div>
      <h2 id="gameOverTitle">ìŠ¹ë¦¬!</h2>
      <p id="gameOverMsg">ìƒëŒ€ ì„œë²„ë¥¼ ë‹¤ìš´ì‹œì¼°ìŠµë‹ˆë‹¤!</p>
      <button class="btn btn-primary" onclick="restartGame()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
  </div>

  <script>
    // ì¹´ë“œ ë°ì´í„°
    const allCards = [
      { id: 'ec2', name: 'EC2', icon: 'ğŸ–¥ï¸', category: 'ì»´í“¨íŒ…', cost: 3, hp: 100, attack: 20,
        desc: 'ê°€ìƒ ì„œë²„. í´ë¼ìš°ë“œì˜ ê¸°ë³¸ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤.',
        effect: 'ê¸°ë³¸ ì„œë²„ ì¹´ë“œ. ì•ˆì •ì ì¸ HP.', services: ['AWS EC2', 'GCP Compute Engine'] },
      { id: 'lambda', name: 'Lambda', icon: 'Î»', category: 'ì»´í“¨íŒ…', cost: 2, hp: 30, attack: 40,
        desc: 'ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜. ì„œë²„ ê´€ë¦¬ ì—†ì´ ì½”ë“œ ì‹¤í–‰.',
        effect: 'HP ë‚®ì§€ë§Œ ê³µê²©ë ¥ ë†’ìŒ.', services: ['AWS Lambda', 'GCP Cloud Functions'] },
      { id: 'k8s', name: 'K8s', icon: 'â˜¸ï¸', category: 'ì»´í“¨íŒ…', cost: 5, hp: 150, attack: 30,
        desc: 'ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í”Œë«í¼.',
        effect: 'ë†’ì€ HP. íŒŒê´´ ì‹œ 50% ë¶€í™œ.', services: ['AWS EKS', 'GCP GKE'] },
      { id: 'rds', name: 'RDS', icon: 'ğŸ—„ï¸', category: 'DB', cost: 4, hp: 120, attack: 15,
        desc: 'ê´€ë¦¬í˜• ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤.',
        effect: 'ë†’ì€ HPë¡œ ì•ˆì •ì .', services: ['AWS RDS', 'GCP Cloud SQL'] },
      { id: 'redis', name: 'Redis', icon: 'âš¡', category: 'DB', cost: 3, hp: 50, attack: 35,
        desc: 'ì¸ë©”ëª¨ë¦¬ ìºì‹œ. ë§¤ìš° ë¹ ë¦„.',
        effect: 'DB ì• ë°°ì¹˜ ì‹œ ë°ë¯¸ì§€ 30% ê°ì†Œ.', services: ['AWS ElastiCache'] },
      { id: 'lb', name: 'LB', icon: 'âš–ï¸', category: 'ë„¤íŠ¸ì›Œí¬', cost: 3, hp: 70, attack: 10,
        desc: 'ë¡œë“œë°¸ëŸ°ì„œ. íŠ¸ë˜í”½ ë¶„ì‚°.',
        effect: 'ì„œë²„ 2ê°œ ì´ìƒ ì‹œ ë°ë¯¸ì§€ ë¶„ì‚°.', services: ['AWS ALB', 'GCP LB'] },
      { id: 'cdn', name: 'CDN', icon: 'ğŸŒ', category: 'ë„¤íŠ¸ì›Œí¬', cost: 2, hp: 40, attack: 0,
        desc: 'ì½˜í…ì¸  ì „ì†¡ ë„¤íŠ¸ì›Œí¬.',
        effect: 'íŠ¸ë˜í”½ ìŠ¤íŒŒì´í¬ ë¬´íš¨í™”.', services: ['CloudFront', 'Cloudflare'] },
      { id: 'waf', name: 'WAF', icon: 'ğŸ›¡ï¸', category: 'ë³´ì•ˆ', cost: 3, hp: 60, attack: 0,
        desc: 'ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°©í™”ë²½.',
        effect: 'SQL Injection ë¬´íš¨í™”.', services: ['AWS WAF', 'Cloud Armor'] },
      { id: 'ssl', name: 'SSL', icon: 'ğŸ”', category: 'ë³´ì•ˆ', cost: 1, hp: 20, attack: 0,
        desc: 'HTTPS ì•”í˜¸í™”.',
        effect: 'ëª¨ë“  ë°ë¯¸ì§€ -5.', services: ['AWS ACM', "Let's Encrypt"] },
      { id: 'cicd', name: 'CI/CD', icon: 'ğŸ”„', category: 'DevOps', cost: 2, hp: 40, attack: 20,
        desc: 'ì§€ì†ì  í†µí•©/ë°°í¬.',
        effect: 'ë§¤í„´ ì¹´ë“œ 1ì¥ ì¶”ê°€ ë“œë¡œìš°.', services: ['GitHub Actions', 'GitLab CI'] },
      { id: 'docker', name: 'Docker', icon: 'ğŸ³', category: 'DevOps', cost: 1, hp: 30, attack: 10,
        desc: 'ì»¨í…Œì´ë„ˆ í”Œë«í¼.',
        effect: 'ë‚®ì€ ì½”ìŠ¤íŠ¸ë¡œ ë¹ ë¥¸ ë°°ì¹˜.', services: ['Docker', 'Podman'] },
      { id: 'prometheus', name: 'Monitor', icon: 'ğŸ“ˆ', category: 'ëª¨ë‹ˆí„°ë§', cost: 2, hp: 40, attack: 0,
        desc: 'ë©”íŠ¸ë¦­ ìˆ˜ì§‘/ëª¨ë‹ˆí„°ë§.',
        effect: 'ìƒëŒ€ ë‹¤ìŒ ê³µê²© ë¯¸ë¦¬ í™•ì¸.', services: ['Prometheus', 'Datadog'] },
    ];

    // ê²Œì„ ìƒíƒœ
    let game = {
      started: false,
      turn: 'player',
      mana: 1,
      maxMana: 1,
      player: { hp: 100, maxHp: 100, field: [], hand: [], deck: [] },
      enemy: { hp: 100, maxHp: 100, field: [] },
      selectedCard: null,
      selectedIndex: null
    };

    // ê²Œì„ ì‹œì‘
    function startGame(difficulty) {
      game = {
        started: true,
        turn: 'player',
        mana: 1,
        maxMana: 1,
        turnCount: 1,
        difficulty,
        player: { hp: 100, maxHp: 100, field: [], hand: [], deck: [] },
        enemy: { 
          hp: difficulty === 'easy' ? 80 : difficulty === 'hard' ? 120 : 100,
          maxHp: difficulty === 'easy' ? 80 : difficulty === 'hard' ? 120 : 100,
          field: []
        },
        selectedCard: null,
        selectedIndex: null
      };

      // ë± ìƒì„±
      game.player.deck = shuffle([...allCards, ...allCards]).slice(0, 20);

      // ì´ˆê¸° í•¸ë“œ
      for (let i = 0; i < 4; i++) drawCard();

      document.getElementById('startScreen').classList.add('hidden');
      updateUI();
      addLog('ê²Œì„ ì‹œì‘!', 'info');
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function drawCard() {
      if (game.player.deck.length > 0 && game.player.hand.length < 7) {
        game.player.hand.push({ ...game.player.deck.pop(), uid: Date.now() + Math.random() });
      }
    }

    // ì¹´ë“œ ì„ íƒ (ìƒì„¸ ë³´ê¸°)
    function selectCard(index) {
      const card = game.player.hand[index];
      if (!card) return;

      game.selectedCard = card;
      game.selectedIndex = index;

      // ìƒì„¸ íŒì—… í‘œì‹œ
      document.getElementById('detailIcon').textContent = card.icon;
      document.getElementById('detailName').textContent = card.name;
      document.getElementById('detailCategory').textContent = card.category;
      document.getElementById('detailCost').textContent = card.cost;
      document.getElementById('detailHp').textContent = card.hp;
      document.getElementById('detailAtk').textContent = card.attack;
      document.getElementById('detailDesc').textContent = card.desc;
      document.getElementById('detailEffect').textContent = 'ğŸ’¡ ' + card.effect;
      document.getElementById('detailServices').innerHTML = 
        card.services.map(s => `<span class="service-tag">${s}</span>`).join('');

      // ë°°ì¹˜ ê°€ëŠ¥ ì—¬ë¶€
      const canPlay = card.cost <= game.mana;
      document.getElementById('detailActions').innerHTML = canPlay
        ? `<button class="btn btn-primary" onclick="playSelectedCard()">ë°°ì¹˜</button>
           <button class="btn btn-danger" onclick="closeCardDetail()">ì·¨ì†Œ</button>`
        : `<button class="btn btn-danger" onclick="closeCardDetail()">ë§ˆë‚˜ ë¶€ì¡±</button>`;

      document.getElementById('cardDetailOverlay').classList.add('active');
    }

    function closeCardDetail(e) {
      if (e && e.target !== e.currentTarget) return;
      document.getElementById('cardDetailOverlay').classList.remove('active');
      game.selectedCard = null;
      game.selectedIndex = null;
    }

    function playSelectedCard() {
      if (game.selectedIndex === null) return;
      const card = game.player.hand[game.selectedIndex];
      if (card.cost > game.mana) return;

      game.mana -= card.cost;
      game.player.field.push({ ...card, currentHp: card.hp, canAttack: false });
      game.player.hand.splice(game.selectedIndex, 1);
      
      addLog(`${card.icon} ${card.name} ë°°ì¹˜!`, 'info');
      closeCardDetail();
      updateUI();
    }

    // í•„ë“œ ì¹´ë“œ ê³µê²©
    function attackWith(index) {
      const card = game.player.field[index];
      if (!card || !card.canAttack || game.turn !== 'player') return;

      card.canAttack = false;

      if (game.enemy.field.length > 0) {
        const target = game.enemy.field[0];
        target.currentHp -= card.attack;
        addLog(`${card.icon} â†’ ${target.icon} (${card.attack} dmg)`, 'damage');
        if (target.currentHp <= 0) {
          game.enemy.field.shift();
          addLog(`${target.icon} íŒŒê´´!`, 'damage');
        }
      } else {
        game.enemy.hp = Math.max(0, game.enemy.hp - card.attack);
        addLog(`${card.icon} ì§ì ‘ ê³µê²©! (${card.attack} dmg)`, 'damage');
      }

      checkGameOver();
      updateUI();
    }

    // í„´ ì¢…ë£Œ
    function endTurn() {
      if (game.turn !== 'player') return;
      game.turn = 'enemy';
      document.getElementById('endTurnBtn').disabled = true;
      
      updateUI();
      setTimeout(enemyTurn, 1000);
    }

    // ì  í„´
    function enemyTurn() {
      const attacks = [
        { name: 'DDoS', icon: 'ğŸ’¥', dmg: 50 },
        { name: 'íŠ¸ë˜í”½ ìŠ¤íŒŒì´í¬', icon: 'ğŸ“ˆ', dmg: 30 },
        { name: 'SQL Injection', icon: 'ğŸ’‰', dmg: 80, blocked: 'waf' }
      ];
      const atk = attacks[Math.floor(Math.random() * attacks.length)];

      let dmg = atk.dmg;
      let blocked = false;

      // WAF ì²´í¬
      if (atk.blocked === 'waf' && game.player.field.some(c => c.id === 'waf')) {
        addLog(`ğŸ›¡ï¸ WAFê°€ ${atk.name} ì°¨ë‹¨!`, 'info');
        blocked = true;
      }

      // CDN ì²´í¬
      if (atk.name === 'íŠ¸ë˜í”½ ìŠ¤íŒŒì´í¬' && game.player.field.some(c => c.id === 'cdn')) {
        addLog(`ğŸŒ CDNì´ ìŠ¤íŒŒì´í¬ í¡ìˆ˜!`, 'info');
        blocked = true;
      }

      // SSL ê°ì†Œ
      if (game.player.field.some(c => c.id === 'ssl') && !blocked) {
        dmg = Math.max(0, dmg - 5);
      }

      if (!blocked) {
        if (game.player.field.length > 0) {
          const target = game.player.field[0];
          target.currentHp -= dmg;
          addLog(`${atk.icon} ${atk.name} â†’ ${target.icon} (${dmg})`, 'damage');
          if (target.currentHp <= 0) {
            game.player.field.shift();
            addLog(`${target.icon} íŒŒê´´!`, 'damage');
          }
        } else {
          game.player.hp = Math.max(0, game.player.hp - dmg);
          addLog(`${atk.icon} ${atk.name}! (${dmg} dmg)`, 'damage');
        }
      }

      checkGameOver();
      setTimeout(startPlayerTurn, 500);
    }

    function startPlayerTurn() {
      game.turn = 'player';
      game.turnCount++;
      game.maxMana = Math.min(10, game.turnCount);
      game.mana = game.maxMana;

      drawCard();
      
      // CI/CD íš¨ê³¼
      if (game.player.field.some(c => c.id === 'cicd')) {
        drawCard();
        addLog('ğŸ”„ CI/CD ì¶”ê°€ ë“œë¡œìš°!', 'info');
      }

      game.player.field.forEach(c => c.canAttack = true);
      document.getElementById('endTurnBtn').disabled = false;
      updateUI();
    }

    function checkGameOver() {
      if (game.enemy.hp <= 0) {
        setTimeout(() => showGameOver(true), 300);
      } else if (game.player.hp <= 0) {
        setTimeout(() => showGameOver(false), 300);
      }
    }

    function showGameOver(win) {
      const el = document.getElementById('gameOver');
      el.className = 'game-over active ' + (win ? 'win' : 'lose');
      document.getElementById('gameOverTitle').textContent = win ? 'ğŸ‰ ìŠ¹ë¦¬!' : 'ğŸ’€ íŒ¨ë°°';
      document.getElementById('gameOverMsg').textContent = win ? 'ì„œë²„ë¥¼ ë‹¤ìš´ì‹œì¼°ìŠµë‹ˆë‹¤!' : 'ì„œë²„ê°€ ë‹¤ìš´ë˜ì—ˆìŠµë‹ˆë‹¤...';
    }

    function restartGame() {
      document.getElementById('gameOver').className = 'game-over';
      document.getElementById('startScreen').classList.remove('hidden');
    }

    function addLog(msg, type = '') {
      const log = document.getElementById('battleLog');
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      entry.textContent = msg;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
      
      // ìµœëŒ€ 10ê°œ ìœ ì§€
      while (log.children.length > 10) {
        log.removeChild(log.firstChild);
      }
    }

    function updateUI() {
      // HP
      const pHpPct = (game.player.hp / game.player.maxHp) * 100;
      const eHpPct = (game.enemy.hp / game.enemy.maxHp) * 100;
      
      document.getElementById('playerHpFill').style.width = pHpPct + '%';
      document.getElementById('playerHpFill').className = 'hp-fill' + (pHpPct < 30 ? ' low' : '');
      document.getElementById('playerHpText').textContent = `${game.player.hp}/${game.player.maxHp}`;
      
      document.getElementById('enemyHpFill').style.width = eHpPct + '%';
      document.getElementById('enemyHpFill').className = 'hp-fill' + (eHpPct < 30 ? ' low' : '');
      document.getElementById('enemyHpText').textContent = `${game.enemy.hp}/${game.enemy.maxHp}`;

      // ë§ˆë‚˜
      document.getElementById('manaText').textContent = `${game.mana}/${game.maxMana}`;

      // í•¸ë“œ
      const hand = document.getElementById('playerHand');
      hand.innerHTML = game.player.hand.map((card, i) => {
        const disabled = card.cost > game.mana;
        const rotation = (i - (game.player.hand.length - 1) / 2) * 5;
        return `
          <div class="hand-card ${disabled ? 'disabled' : ''}" 
               style="transform: rotate(${rotation}deg);"
               onclick="selectCard(${i})">
            <span class="cost">${card.cost}</span>
            <span class="icon">${card.icon}</span>
            <span class="name">${card.name}</span>
            <span class="stats">
              <span class="atk">âš”${card.attack}</span>
              <span class="hp">â¤${card.hp}</span>
            </span>
          </div>
        `;
      }).join('');

      // í”Œë ˆì´ì–´ í•„ë“œ
      const pField = document.getElementById('playerField');
      pField.innerHTML = game.player.field.length > 0
        ? game.player.field.map((card, i) => `
            <div class="field-card ${card.canAttack ? 'can-attack' : ''}" onclick="attackWith(${i})">
              <span class="icon">${card.icon}</span>
              <span class="name">${card.name}</span>
              <span class="card-atk">âš”${card.attack}</span>
              <span class="card-hp">â¤${card.currentHp}</span>
            </div>
          `).join('')
        : '<span class="field-placeholder">ì¹´ë“œë¥¼ ë°°ì¹˜í•˜ì„¸ìš”</span>';

      // ì  í•„ë“œ
      const eField = document.getElementById('enemyField');
      eField.innerHTML = game.enemy.field.length > 0
        ? game.enemy.field.map(card => `
            <div class="field-card">
              <span class="icon">${card.icon}</span>
              <span class="name">${card.name}</span>
              <span class="card-atk">âš”${card.attack}</span>
              <span class="card-hp">â¤${card.currentHp}</span>
            </div>
          `).join('')
        : '<span class="field-placeholder">ì  ì„œë²„</span>';
    }
  </script>
</body>
</html>
